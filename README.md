# Рекомендательная система для социальной сети
Придумана условная социальная сеть, со следующим функционалом: можно отправлять друг другу письма, создавать сообщества, аналогичные группам в известных сетях, и в этих сообществах публиковать посты. При регистрации пользователи должны заполнять данные по своему профилю, которые хранятся в поднятой postgres database. Так же платформа обладает лентой, которую пользователи могут листать и просматривать случайные записи случайных сообществ. Если пост нравится, можно поддержать автора и поставить like. Все действия пользователей сохраняются, каждая их активность, связанная с просмотром постов, тоже записывается в базу.
В рамках проекта необходимо построить рекомендательный сервис постов в социальной сети

## Задача
* Провести разработку рекомендательного сервиса, который на базе данных о пользователях и постах будет предлагать топ-5 публикаций для пользователя, с большей вероятностью которые юзер лайкнет
* При этом уложиться в рамки требований по метрикам и техническим ограничениям (о них далее)

## Требования по работе рекомендательного сервиса
* Скорость работы сервиса. Среднее время работы одного запроса должно быть не более __~0,5 секунд__. 
* Установлены ограничения по памяти: не больше, чем __~4 гб RAM__ на запуск 
* Установлены ограничения на качество модели: 
	* На 2-м этапе проекта HitRate@5 должен быть больше __0.52__
	* На 3-м этапе проекта HitRate@5 должен быть больше __0.57__

 ## Этапы разработки
1. Подготовка основы сервиса на базе FAST API
	+ Выполнил настройку виртуального окружения,
	+ Установил основные пакеты для использования будущего сервиса
	+ Настроил pydentic схему
2. Выгрузка данных, EDA, использование моделей классического машинного обучения, настройка сервиса
	+ Произвел выгрузку данных с проверкой значений на пропуски, типы данных, добавлением доп. фичей по времени и проверку взаимосвязи с таргетным значением.
	+ По EDA и гистограммам распределения выделил фичи у которых слабая взаимосвязь с таргетом.
	+ Добавил дополнительные фичи для текстов постов: tf-idf с агрегатными значениями.
	+ Выполнил предобработку фичей и валидацию трейн/тест перед обучением (отложенная выборка по дате, 20% на тест)
	+ Выделил для обучения несколько вариантов по моделям: DecisionTreeClassifier, RandomForestClassifier, CatBoostClassifier c выбором для итога последней после попытки регуляризации первых 2-х
	+ Произвел настройку сервиса на базе FAST API с использованием обученной модели CatBoostClassifier
3. Доработка модели и сервиса (используя эмбединги, deep learning)
	+ Для улучшения качества модели отдельно выполнил подготовку эмбедингов на основе предобученной модели RoBerta
	+ Выполнил декомпозицию эмбедингов с помощью PCA до 25 компонент (для сохранения большей части информации, порядка 70%)
	+ Добавил доп. фичу по количеству символов постов (гипотеза: влияние объема на вероятность лайка)
	+ Произвел обучение модели с новыми фичами и сделал настройку сервиса под новые фичи и модель	
4. Построение отдельного сервиса для использования A/B тестирования (для примера взяты модели из 2-го и 3-го этапов разработки)
	+ Реализовал разделение пользователей по их id на 2 группы используя hashlib
	+ Разделил применение моделей: для контрольной группы модель из 2-го этапа, для тестовой из 3-го этапа

## В результате
Удалось разработать сервис согласно задаче проекта: 
* Рекомендательную систему, которая на базе данных о пользователях и постах (в случае моего проекта это обученная на подготовленных данных модель CatBoost) предлагает топ-5 публикаций для пользователя
* И при этом удалось уложиться как по техническим требованиям, так и по метрике работы модели. На 2-м этапе HitRate@5 составил 0.55, на 3-м 0.59
* Дополнительно также был реализован сервис для A/B тестов

## Доступное окружение для сервиса (для чекера проекта)
```
fastapi==0.75.1
pandas==1.4.2
sqlalchemy==1.4.35
requests==2.27.1
catboost==1.0.6
numpy==1.22.4
pydantic==1.9.1
scikit_learn==1.1.1
lightgbm==2.0.3
xgboost==1.6.1
psycopg2-binary==2.9.3
uvicorn==0.16.0
category-encoders==2.5.0
loguru==0.6.0
implicit==0.5.2
lightfm==1.16
```

## Описание основных файлов из проекта
* "app.py" - основной сервис для 1-3 этапов
* "check_eda_learn.ipynb" - Jupiter Notebook с проверкой данных, EDA, обучению моделей для 2-3 этапов
* "emb-posts-pretrain.ipynb" - Jupiter Notebook с подготовкой эмбедингов постов для 3-го этапа
* "app_ab.py" - сервис для использования a/b тестов


